## 页面范围与目标

* 在 `app/assets/[id]/page.tsx` 的资产详情页为类型为 `fund` 的资产新增两块功能：

  * 货币基金信息输入：支持输入/编辑币种（已有）、年化利率、起始日期。

  * 收益展示：基于基础金额、年化利率、起始日期，实时计算并展示每日收益、每月收益、每年收益、累计收益。

* 现有详情页逻辑：在 `app/assets/[id]/page.tsx:46` 通过 `asset.type.code === 'stock' || asset.type.code === 'fund'` 判断股票/基金类型，用于持仓管理。我们将复用该类型判断，在基金类型下新增上述功能卡片。

## 数据模型与接口调整

* Prisma 模型：在 `prisma/schema.prisma` 的 `model Asset` 增加两字段（与负债利率的精度保持一致）：

  * `annualRate Decimal? @db.Decimal(8, 4)`

  * `startDate DateTime?`

* Zod 校验（服务端）：在 `lib/schemas.ts` 增加可选字段以兼容更新与创建：

  * `AssetCreateSchema`/`AssetUpdateSchema`：新增 `annualRate: z.number().nonnegative().optional()`，`startDate: z.preprocess(v => (v ? new Date(v as string) : undefined), z.date().optional())`

* API 路由：

  * `app/api/assets/route.ts` 与 `app/api/assets/[id]/route.ts` 已直接使用 Zod 解析后的 `parsed.data` 写入数据库，只需通过上述校验扩展，即可接受新字段；无需改动控制器逻辑。

* 数据迁移：创建 Prisma 迁移并执行：

  * `npx prisma migrate dev --name add_asset_money_fund_fields`

## 前端表单与交互

* 详情页基金信息卡片（仅当 `asset.type.code === 'fund'` 显示）：

  * 输入项：

    * 年化利率（百分比数字，存储为小数，如 0.025 表示 2.5%）

    * 起始日期（`startDate`）

    * 币种沿用现有资产字段 `currency`（已在 `app/assets/[id]/page.tsx:79` 展示）

  * 状态：使用本页现有的 `useState` 模式（参考持仓与资产编辑），新增基金信息本地 state，初始值从 `asset.annualRate`、`asset.startDate` 填充。

  * 保存：点击“保存基金信息”发起 `PUT /api/assets/{id}`，请求体包含 `annualRate` 与 `startDate`（以及必填的现有资产字段）。成功后刷新页面数据。

## 收益计算与展示

* 计算依据：

  * 本金：使用 `asset.amount`

  * 年化利率：`annualRate`（小数，如 0.03 表示 3%）

  * 起始日期：`startDate`

* 计算公式（先采用简单日度计提，不考虑复利）：

  * 每日收益：`daily = amount * annualRate / 365`

  * 每月收益（按 12 个月近似）：`monthly = amount * annualRate / 12`

  * 每年收益：`yearly = amount * annualRate`

  * 累计收益（从起始日期至今天的天数）：`cumulative = amount * annualRate * daysElapsed / 365`

* 计算展示：在“收益概览”卡片内显示四项，随 `amount`、`annualRate`、`startDate` 变化即时更新。数值格式可使用 `toFixed(2)`（大额时可考虑 `formatAmount`）。

* 容错：

  * 当 `annualRate` 或 `startDate` 未填写时，收益卡片显示提示信息；填写后立即显示计算结果。

## 页面实现细节

* 组件与样式：沿用现有 `components/ui/Input`、`Button`、`Card`、`Modal` 与 Tailwind 栅格布局（参考 `app/assets/[id]/page.tsx:74-88` 与 `96-103`）。

* 数据刷新：复用现有 `refresh()`（`app/assets/[id]/page.tsx:28-41`），保存成功后刷新并给出成功提示。

* 类型与解析：前端发送 `annualRate` 为数字，`startDate` 为日期字符串，服务端 Zod 负责解析与校验。

## 兼容性与回退策略

* 不影响非基金资产：仅在基金类型显示并保存新增字段。

* 旧数据兼容：新字段为可选；未填写时不参与收益计算，UI 给出引导提示。

* 现有功能保持：持仓管理（股票/基金）与资产变更时间线（`app/assets/[id]/page.tsx:130-149`）保持不变。

## 验证方案

* 本地开发验证：

  * 新建或编辑基金类型资产，填写金额、年化利率、起始日期。

  * 检查详情页“收益概览”是否正确显示每日/月度/年度/累计收益，随输入实时更新。

  * 校验 API：创建与更新请求体含新字段，服务端返回成功并在 GET 中能看到新字段。

* 边界用例：

  * 年化利率为 0、极小值、较大值（如 0.1）

  * 起始日期为今天/历史日期；跨年累计天数计算。

  * 金额大/小的数值格式化。

## 后续可选扩展

* 复利/APY 支持：按日复利计算累计收益；提供切换选项（简单/复利）。

* 更精确的月份天数：按实际月份天数计算月度收益。

* 多币种汇总：结合汇率将收益换算为主币种展示。

* 收益曲线：按日生成收益时间序列并绘制图表。

——请确认以上方案后，我将按此实施：数据库迁移、服务端校验扩展、前端详情页新增卡片与收益计算展示，并完成端到端验证。 确认该方案
