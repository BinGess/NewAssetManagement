## 问题判断
- 目前“货币基金”资产金额与“资产变更详情”未见每日自动入账，说明定时作业未触发或作业逻辑未正确记账。

## 目标
- 每天 00:01（Asia/Shanghai）对货币基金执行日复利：将当日收益计入资产总额，并新增一条 AssetChange 记录（before/after/diff/notes）。
- 支持停机补算：若估值日期滞后，按差异天数逐日补记，确保幂等（同一日不重复记账）。

## 排查与改造

### 1. 调度与鉴权校验
- 确认 Render Cron 配置：
  - Method: POST
  - URL: `/api/jobs/money-fund-daily`
  - Header: `X-Job-Token: <JOB_TOKEN>`
  - 服务环境变量存在：`JOB_TOKEN=<同值>`
- 手动验证（模拟定时触发）：使用 curl/Postman 发送 POST 并携带 Header，预期返回 `{ processed: N }`。如未授权返回 401，先修复 JOB_TOKEN。

### 2. 作业逻辑修正
- 以 Asia/Shanghai 为基准计算“当日起止时间”，避免 UTC 导致的跨天误判。
- 补算多日：从 `lastValuationDate`（或最后一条自动收益的日期）到今天的天数 `days`，逐日循环：
  - `interest = amount * annualRate / 365`
  - `after = amount + interest`（保留两位小数）
  - 更新 `Asset.amount` 与 `Asset.valuationDate = 该日`，并写入 `AssetChange.at = 该日`、`notes = '自动收益(日复利)'`
  - 幂等：若该日已存在自动收益记录则跳过。
- 事务包裹：单日的更新与记账使用数据库事务，防止部分成功。

### 3. 资产筛选与类型识别
- 资产筛选包含：`type.code in ['huobi','money_fund']` 或 `type.label` 包含“货币基金”，并且 `annualRate` 与 `startDate` 非空。

### 4. 前端配合（可选优化）
- 详情页进入时：若 `valuationDate` 不是今天，提示“将于 00:01 自动更新”。
- 提供“立即计算”按钮（仅管理员），调用作业接口强制执行一次，便于手动排查。

### 5. 验证步骤
- 构造一个 `huobi` 资产（`annualRate=0.03`、`startDate=过去日期`），手动触发作业；检查：
  - `Asset.amount` 增加、`valuationDate` 更新到当天
  - `AssetChange` 新增一条“自动收益(日复利)”记录（数值正确）
- 重复触发当天作业，确保幂等；调整系统时间或修改 `valuationDate` 测试补算多日逻辑。

## 交付
- 修正作业代码以支持时区、补算、幂等与事务
- 提供 curl 示例与 Render Cron 配置说明，确保线上稳定触发

请确认以上计划，我将按此实施修复并完成验证。